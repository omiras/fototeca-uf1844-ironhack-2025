<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Image</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
</head>

<body>
    <!-- Carga el fichero partials/navbar.ejs -->
    <%- include('./partials/navbar') %>
    
    <h1>Add New Image</h1>
    <form class="container" action="/new-image" method="post">
        <label for="title">Título: </label>
        <input type="text" name="title" id="title">
        <label for="url">URL: </label>
        <input type="text" name="url" id="url">
        <span id="url-feedback" style="color: red;"></span>
        <label for="description">Descripción: </label>
        <textarea name="description" id="description" rows="3"></textarea>
        <input type="submit" value="Añadir Foto" id="submit-btn">
    </form>
    <% if (message) { %>
    <section>
        <p><%= message %></p>     
    </section>
    <%  } %>
    <script>
        const urlInput = document.getElementById('url');
        const feedback = document.getElementById('url-feedback');
        const submitBtn = document.getElementById('submit-btn');
        urlInput.addEventListener('blur', async () => {
            const url = urlInput.value.trim();
            if (!url) {
                feedback.textContent = '';
                submitBtn.disabled = false;
                return;
            }
            const res = await fetch(`/check-url?url=${encodeURIComponent(url)}`);
            const data = await res.json();
            if (data.exists) {
                feedback.textContent = 'Esta URL ya existe en la fototeca.';
                submitBtn.disabled = true;
            } else {
                feedback.textContent = '';
                submitBtn.disabled = false;
            }
        });
    </script>
</body>

</html>